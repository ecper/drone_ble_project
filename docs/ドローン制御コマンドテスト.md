# ドローン制御コマンドテスト

## LightBlueでのコマンド送信手順

### 設定
1. LightBlueで「RaspberryPiDrone」に接続
2. 書き込み用キャラクタリスティック（6E400002...）をタップ
3. **「UTF-8 String」モードを選択**（重要）

### テストコマンド順序

#### 1. 基本動作確認
まず以下のシンプルなコマンドから開始：

```
TEST
HELLO
STATUS
```

期待されるログ：
```
Received BLE command: 'TEST'
Sent to Arduino via I2C: 'TEST'
```

#### 2. スロットルのみのテスト
モーターを動かさない安全な値から開始：

```
T0
T10
T25
T50
```

#### 3. 基本的な制御コマンド
フォーマット: `T[スロットル],P[ピッチ],R[ロール],Y[ヨー]`

```
T0,P0,R0,Y0
T25,P0,R0,Y0
T50,P0,R0,Y0
T50,P10,R0,Y0
T50,P0,R10,Y0
T50,P0,R0,Y10
```

#### 4. 複合制御コマンド
```
T50,P10,R5,Y0
T75,P-10,R-5,Y20
T100,P15,R-15,Y-45
```

#### 5. 緊急停止コマンド
```
STOP
```

### コマンドパラメータの範囲

| パラメータ | 記号 | 範囲 | 単位 | 説明 |
|-----------|------|------|------|------|
| スロットル | T | 0-100 | % | モーター出力 |
| ピッチ | P | -45 to +45 | 度 | 前後の傾き |
| ロール | R | -45 to +45 | 度 | 左右の傾き |
| ヨー | Y | -180 to +180 | 度 | 回転 |

### 安全なテスト手順

1. **Arduino未接続でテスト**
   - まずArduinoを接続せずにコマンド送受信のみ確認
   - Raspberry Piのログで正しく受信されることを確認

2. **Arduino接続・モーター未接続**
   - ArduinoをI2C接続
   - モーター/ESCは接続しない
   - Arduinoのシリアルモニタでコマンド受信を確認

3. **低出力でのモーターテスト**
   - プロペラを外した状態でモーターを接続
   - T10以下の低出力でテスト

### ログ確認ポイント

#### Raspberry Pi側
```bash
# 正常なコマンド受信
INFO - Received BLE command: 'T50,P10,R0,Y0'
INFO - Sent to Arduino via I2C: 'T50,P10,R0,Y0'

# ステータス通知（StatusCharacteristicで確認）
INFO - Notified status: 'CMD_RX:T50,P10,R0,Y0'
```

#### Arduino側（シリアルモニタ）
```
I2C Received: T50,P10,R0,Y0
Flight Params - T:50 P:10 R:0 Y:0
```

### トラブルシューティング

#### コマンドが送信されない
- UTF-8 Stringモードが選択されているか確認
- 改行やスペースが含まれていないか確認

#### I2Cエラーが発生
```bash
# I2C接続確認
sudo i2cdetect -y 1

# 期待される出力（0x08にArduinoが検出される）
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- 08 -- -- -- -- -- -- --
```

#### 通知（Notify）のテスト
1. StatusCharacteristic（6E400003...）をタップ
2. 「Listen for notifications」をON
3. Raspberry Piから送信される状態更新を確認

### 推奨テストシーケンス

```
1. TEST              → 基本的な送受信確認
2. STATUS            → ステータス要求
3. T0,P0,R0,Y0      → 全パラメータゼロ
4. T25,P0,R0,Y0     → スロットルのみ25%
5. T25,P10,R0,Y0    → ピッチ追加
6. T25,P10,R5,Y0    → ロール追加
7. T25,P10,R5,Y15   → ヨー追加
8. STOP             → 緊急停止確認
```