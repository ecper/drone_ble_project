# LightBlue書き込みトラブルシューティング

## 問題: 書き込みデータが空になる

LightBlueアプリから書き込んだデータが空として受信される場合の対処法です。

## LightBlueでの正しい書き込み方法

### 1. Text形式での書き込み

1. **Write画面で「UTF-8 String」を選択**
   - デフォルトでは「Hex」が選択されている場合があります
   - 「UTF-8 String」または「Text」オプションを選択してください

2. **テキストを入力**
   - 例: `T50,P0,R0,Y0`
   - 改行やスペースを含めないように注意

3. **「Write」または「Send」をタップ**

### 2. Hex形式での書き込み（代替方法）

文字列が送信できない場合は、Hex形式で送信：

1. **「Hex」を選択**
2. **文字列を16進数に変換して入力**
   - 例: "TEST" → `54 45 53 54`
   - "T50" → `54 35 30`

### 3. 一般的な16進数変換表

| 文字 | Hex | 文字 | Hex |
|------|-----|------|-----|
| T | 54 | 0 | 30 |
| P | 50 | 1 | 31 |
| R | 52 | 2 | 32 |
| Y | 59 | 3 | 33 |
| , | 2C | 4 | 34 |
| - | 2D | 5 | 35 |

例: "T50,P10,R0,Y0" → `54 35 30 2C 50 31 30 2C 52 30 2C 59 30`

## nRF Connectを使用する場合

nRF Connectの方が書き込みフォーマットが明確です：

1. **キャラクタリスティックの矢印アイコンをタップ**
2. **「TEXT」タブを選択**
3. **テキストを入力**
4. **「SEND」をタップ**

## デバッグ用ログの確認

修正したコードでは、以下のデバッグ情報が表示されます：

```
Raw value type: <class 'dbus.Array'>, length: X
Raw value bytes: ['0x54', '0x35', '0x30', ...]
Received BLE command: 'T50,P0,R0,Y0'
```

これにより、どのようなデータが受信されているか確認できます。

## テスト手順

1. **簡単な文字列から開始**
   - まず「TEST」のような単純な文字列を送信
   - ログで正しく受信されることを確認

2. **コマンド形式をテスト**
   - 「T50」→「T50,P0」→「T50,P0,R0,Y0」と段階的に複雑にする

3. **エラーメッセージの確認**
   - `ERR:Empty_CMD`: 受信データが完全に空
   - `ERR:Empty_STR`: デコード後の文字列が空
   - `ERR:Decode`: UTF-8デコードエラー
   - `ASCII:xxx`: ASCII文字として解釈された内容

## 他のBLEアプリの推奨

書き込みが上手くいかない場合は、以下のアプリも試してください：

1. **BLE Scanner** (by Bluepixel Technologies)
   - シンプルで使いやすいインターフェース

2. **Bluefruit Connect** (by Adafruit)
   - UART機能があり、テキスト送信が簡単

3. **BLE Terminal** 
   - ターミナル風のインターフェースで文字列送信に特化